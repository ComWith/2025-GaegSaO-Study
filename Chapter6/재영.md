# 📘 06 / 객체 지도

## 개요
- **길 안내(기능 지향)** vs **지도(구조 지향)**  
  → **구조 중심 모델**이 더 **범용적·이해 용이·변경 안정적**이다.


- 기능을 구조에 종속시키지 말고, **안정적인 구조**를 먼저 잡고 **기능을 그 위에 얹어라**.  
  ⇒ 자주 바뀌는 **기능**이 아니라 덜 바뀌는 **구조**를 따라 **역할·책임·협력**을 구성.

---

## 기능 설계 대 구조 설계
- **기능(function)**: 제품이 사용자를 위해 **무엇을 하는가** (매력·시장성)
- **구조(structure)**: 제품의 형태가 **어떠해야 하는가** (안정·유연성)


- **전통적인 기능 분해**: 기능 중심 → 구조가 흔들림(변경 취약).
- **객체지향 접근**: **안정적인 구조(객체 관계)** 중심 → 기능을 **책임**으로 분배(변경에 강함).  
  ⇒ **나중에 바꿀 여지**를 남김으로써, **변경 비용을 낮추는 설계**가 목표.

---

## 두 가지 재료: 기능과 구조
- **구조**: 도메인 개념과 관계로 표현 (**도메인 모델링**).
  - 시스템의 기능을 구현하기 위한 기반. 기능 변경을 수용할 수 있도록 안정적이어야 함.
- **기능**: 사용자 목표를 만족시키는 시스템의 행위 (**유스케이스 모델링**).

⇒ **안정 구조**(**도메인 모델**) + **변하는 기능**(**유스케이스**)을 **책임·협력**으로 엮는다.

---

## 안정적인 재료: 구조(도메인 모델)
- **도메인**: 사용자가 프로그램을 쓰는 대상 분야.
- **모델**: 대상을 추상화해 지식과 제약을 구조화한 표현.


- **도메인 모델**: 도메인 내 개념·관계·규칙·제약의 추상화
    
    (이해관계자의 **멘탈 모델** 반영).


- 도널드 노먼의 세 가지 모델: 
  - **사용자 모델** : 사용자가 제품에 대해 가지고 있는 개념들의 모습
  - **디자인 모델** : 설계자가 마음 속에 갖고 있는 시스템에 대한 개념화
  - **시스템 이미지** : 최종 제품
- 설계 목표: **시스템 이미지가 사용자 모델을 정확히 반영**.
- 세 가지 모델이 모두 유사한 모습을 유지하도록 만들어야 함.

  → **연결완전성** 또는 **표현적 차이**


⇒ **표현적(의미적) 차이**를 줄여라. 소프트웨어 객체는 **도메인 모델의 개념**을 **은유**해야 한다.


- 도메인 모델 기반 설계 → 사용자의 멘탈 모델(관점)이 그대로 코드에 표현.
- 도메인 모델은 **본질적 개념/규칙**을 담아 **변경 가능성이 낮다** → **안정 구조 제공**.

> **예제**
>
> ---
> **정기예금 도메인 모델**
>
> … (설명 생략) …
>
> **정기예금**은 예금 기간과 이미 해지된 예금인 지 여부를 나타내는 속성을 포함한다.
>
> **계좌**는 예금주가 예치한 예금액을 보관하고
>
> **이자율**을 만기 시 예금주에게 지급할 이자를 계산하기 위해 필요한 금리 정보를 포함한다.
>
> **계좌**는 특정한 정기예금에 속하므로 **정기예금**과 관계를 맺는다.
>
> **이자율**은 특정한 계좌에 대한 금리 정보를 나타내므로 **계좌**와 관계를 맺어야 한다.
>
> 만기 시 계좌의 예금액과 함께 이자를 지급해야 하므로 **이자**는 예금액을 알고 있는 **계좌**와 관계를 맺는 것이 적절하다.
>
> 이자는 만기 시점에 지급되며 예금 기간 동안에는 존재하지 않는다. 따라서 **계좌**와 **이자** 사이에는 0 또는 1의 다중성(0..1)이 존재한다.
>
> 정기예금은 만기가 되지 않더라도 중도에 해지가 가능하므로 정기예금 기간이 반드시 이자의 지급일자와 동일하지는 않다. 따라서 **이자**는 지급된 일자에 관한 정보를 별도로 보관해야 한다.
>
> ---
> 해당 모델은 예금주나 은행업무 담당 도메인 전문가들이 쉽게 파악 가능하다.
>
> 따라서 이 모델은 세 가지 모델 중 사용자 모델의 관점을 반영한다.
>
> 가장 중요한 것은 이 모델이 안정적이라는 것이다. 은행 업무에서 다뤄지는 정기예금의 정의가 변경되지 않는 한 해당 모델의 개념은 쉽게 변경되지 않는다.
>
> 도메인 모델의 장점은 비즈니스 개념과 정책을 반여하는 안정적인 구조를 제공한다.

---

## 불안정한 재료: 기능(유스케이스)
- **유스케이스**: 사용자 목표 달성 위해 **사용자-시스템 상호작용 흐름**을 텍스트로 정리한 것.
- **일차 액터**가 서비스를 요청, 유스케이스는 요청에 대한 시스템의 응답으로, 다양한 조건하에 있는 시스템의 행위들을 서술함. 

  (유기적 시나리오들의 집합)
- **가치**: 흩어진 기능을 **사용자 목표**라는 문맥으로 **유기적으로 연결**.

> #### ✏️ 이해관계자와 일차 액터
>
> ---
> ### 시스템 관점
> - **이해관계자(stakeholder)**: 시스템에 이해관계를 가지는 모든 외부 주체.
>
>   (사용자, 외부 시스템, 관리자, 경영진 등)
>
>   ⬇️
> - **액터(actor)**: 그중에서 시스템과 직접 상호작용하는 외부 주체.
>
>   ⬇️
> - **일차 액터(primary actor)**: 시스템의 서비스를 요청하여 유스케이스를 시작하는 주체.
> - 자신이 가진 **하나의 구체적인 목표**를 달성하기 위해 시스템과 상호작용을 시작함.
>   - 예: 고객이 “커피 주문하기” 버튼을 누르는 행위.
> - **보조 액터(secondary actor)**: 유스케이스가 진행되도록 지원하는 주체.
>   - 예: 결제 시스템, 신용카드사 등.
>
> ### 유스케이스(Use Case)의 본질
> 유스케이스 = 일차 액터의 목표 달성을 위해 시스템이 제공하는 응답(행동) 시나리오.
>
> 즉, 일차 액터가 시스템에 서비스 요청 → 시스템이 응답 → 상호작용의 흐름 전체가 유스케이스임.

> #### ✏️ 유스케이스와 일차 액터
>
> ---
> > “유스케이스는 일차 액터의 요청에 대한 시스템의 응답으로, 다양한 조건하에 있는 시스템의 행위를 서술함.”
>
> 1. **일차 액터의 요청**
     >    - 유스케이스는 항상 **일차 액터가 시스템에 서비스 요청**하는 것에서 시작한다.
>    - 예: 고객(일차 액터)이 “상품 주문” 버튼을 누른다.
> 2. **시스템의 응답**
     >    - 시스템은 액터의 요청에 대해 **어떻게 반응하고 처리할지**를 보여준다.
>    - 예: 주문 내역을 확인하고, 결제를 처리하고, 주문 완료 메시지를 보여줌.
> 3. **다양한 조건하의 시스템 행위**
     >    - 유스케이스는 단순히 "정상 시나리오"만 그리는 게 아니라, **여러 조건/상황에서 시스템이 어떻게 반응하는지**도 포함한다.
>    - 예:
       >      - 결제가 정상적으로 승인된 경우 → 주문 완료
>      - 결제 카드 한도가 초과된 경우 → 오류 메시지 반환
>      - 재고가 없는 경우 → “품절” 안내
>
> ⇒ 즉, 유스케이스는 “**일차 액터가 목표 달성을 위해 요청했을 때, 시스템이 여러 상황(조건)에 따라 어떤 행위를 하는지 기술한 시나리오**”라는 뜻.

> **예제**
>
> ---
> **정기예금 이자 계산 유스케이스**
>
> … (설명 생략) …
> > **유스케이스명:** 중도 해지 이자액을 계산한다
> >
> >
> > **일차 액터:** 예금주
> >
> > **주요 성공 시나리오:**
> >
> > 1. 예금주가 정기예금 계좌를 선택한다.
> > 2. 시스템은 정기예금 계좌 정보를 보여준다.
> > 3. 예금주가 금일 기준으로 예금을 해지할 경우 지급받을 수 있는 이자 계산을 요청한다.
> > 4. 시스템은 중도 해지 시 지급받을 수 있는 이자를 계산한 후 결과를 사용자에게 제공한다.
> >
> > **확장:**
> >
> > 3a. 사용자는 해지 일자를 다른 일자로 입력할 수 있다.


**유스케이스의 중요 특성 :**
1) **사용자-시스템 간의 상호작용을 보여주는 ‘텍스트’다.**(다이어그램 아님)
2) **여러 시나리오들의 집합이다.**(유스케이스 인스턴스)
3) **단순한 피처(feature) 목록과 다르다.**(문맥으로 기능을 엮음)
4) **사용자 인터페이스 관련 세부 정보를 포함하지 말아야 한다.**(사용자 관점의 시스템 행위에 초점)
5) **내부 설계와 관련된 정보를 포함하지 않는다.**(외부 관점만을 표현)

---

## 재료 합치기: 기능과 구조의 통합
- 유스케이스의 **기능**을, 도메인 모델의 **안정 구조** 위에서 **객체 책임**으로 분배.
- 사용자의 관점에서 시스템은 **메시지에 응답하는 하나의 큰 객체**처럼 보인다.  
  - 큰 책임은 **내부 객체들의 협력**으로 구현.


- 책임-주도 설계의 **시작점** = 협력의 **첫 번째 메시지**
  - 유스케이스의 시스템 기능 → **시스템 책임**으로 변환 → **첫 메시지** 도출.
  - 이후, 도메인 모델에서 **책임을 맡을 적합 객체**를 찾아 협력 구성.

> **객체 설계**는 가끔 다음과 같이 표현되기도 함 :
>
> 요구사항들을 식별하고 도메인 모델을 생성한 후, 소프트웨어 클래스에 메서드들을 추가하고, 요구사항을 충족시키기 위해 객체들 간의 메시지 전송을 정의하라.

- 책임-주도 설계(RDD)는 :
  - 유스케이스로부터 **첫 번째 메시지**와 목표를, 
  - 도메인 모델로부터 **구조**를 제공받아 협력을 창조한다.

> **예제**
>
> ---
> **이자 계산 기능 구현**
>
> 유스케이스는 시스템이 ‘중도 해지 이자액을 계산하는 기능을 제공해야 한다’고 보여줌.
>
> 여기서 시스템을, ‘중도 해지 이자액을 계산하라’라는 메시지를 받는 **거대한 객체**라고 가정함.
>
> 시스템에 할당된 책임은 시스템 내부의 객체들의 협력으로 구현돼야 함.
>
> → 할당받을 객체들을 도메인 모델을 힌트로 하여 객체 구조를 설계
>
> ---
> > **추가 기능**
> >
> > 예금주가 금일 기준으로 예금을 해지할 경우 지급받을 수 있는 이자 계산을 요청한다.
> >
> > 시스템은 중도 해지 시 지급받을 수 있는 이자를 계산한 후 결과를 사용자에게 제공한다.
>
> 도메인 모델을 기반으로 ‘이자 계산’이라는 시스템 책임을 아래와 같이 분할하고 객체들에게 할당함.
>
> → 협력하는 객체들의 공동체 형성
>
> ---
> **정기예금**은 해지 일자를 전달받아 **이자** 계산을 시작하는 책임을 맡는다.
>
> **정기예금**은 해당 일자가 약정 기간에 포함되는지 확인한 후 포함될 경우 **계좌**에게 **이자** 계산을 요청한다.
>
> **계좌**는 예금액과 해지 일자를 **이자율**에게 전달해서 이자를 계산하게 한다.
>
> **이자율**은 전달받은 예금액과 해지 일자를 이용해 이자액을 계산한 후 이자액을 포함하는 **이자**를 생성해서 반환한다.
>
> ---
> 필요에 의해 식별된 객체와 책임을 바탕으로 기능을 구현함.
>
> (객체 → 클래스, 도메인 모델의 속성 → 인스턴스 변수, 책임 → 메서드)

- 객체의 이름은 도메인 모델에 포함된 개념으로부터 차용한다.
  - 예: 은행 도메인 모델 → `계좌(Account)`, `이자율(InterestRate)`, `거래(Transaction)`
- 책임은 도메인 모델에 정의한 개념의 정의에 부합하도록 할당한다.
  - 이자 계산 책임 → 이자율(Rate) 필요 → ‘`이자율(InterestRate)`’ 객체에게 할당.
  - 즉, ‘이자율’이 ‘이자’ 객체를 생성하는 책임을 갖게 됨.

⇒ 책임을 수행하는 데 필요한 정보를 가진 객체에게 그 책임을 할당하는 것이 기본 원칙이다.


- 유스케이스에서 객체들의 협력으로 이어지는 일련의 흐름은 **재귀적 합성**이라는 객체지향의 기본 개념을 잘 보여준다.
  - **재귀적 합성(Recursive Composition)** : 큰 기능은 작은 기능들의 협력으로 이뤄짐.

    → 재귀적 합성은 메시지의 교환을 통해서만 처리할 수 있음.

> #### ✏️ (참고) 절차적 언어 - 자료구조 + 프로시저
>
> ---
> **절차적 프로그래밍**
>   - 시스템을 **데이터(자료구조)**와 그 데이터를 처리하는 **절차(프로시저, 함수)**로 나눠서 봄.
>   - 즉, “데이터는 따로 있고, 그것을 조작하는 함수는 따로 있다”라는 구조.
>
> 반대 개념 → **객체지향 프로그래밍**
>   - 객체지향에서는 데이터와 절차를 따로 두지 않고 **하나의 객체 안에 묶어버림**.
>   - 즉, 데이터(상태)와 그 데이터를 다루는 행동(메서드, 책임)을 한 덩어리로 만듦.

- 도메인 모델 구성요소의 특징 :
  - 구성 개념은 **비즈니스가 없어지거나 완전히 개편되지 않는 한 안정적으로 유지**된다.
  - 개념 간의 관계는 비즈니스 규칙을 기반으로 하기 때문에 **비즈니스 정책이 크게 변경되지 않는 한 안정적으로 유지**됨.
    
    → 기능적 요구사항 변경 시, 책임과 객체 간의 대응 관계만 수정될 뿐임.

> **예제**
>
> ---
> **이자 계산 기능의 변경**
>
> … (설명 생략) …
>
> 이자를 계산하기 위해 단리 이자 방식과 복리 이자 방식을 유연하게 선택할 수 있어야 함.
>
> 기존의 단리 이자만을 계산하던 InterestRate 클래스를 추상 클래스로 변경하고 단리 이자를 계산하는 SimpleInterest와 복리 이자를 계산하는 CompoundInterest가 InterestRate를 상속받게 한 것임.
>
> InterestRate에 정의된 `createInterest()` 메시지를수신할 경우 객체의 타입에 따라 실행될 메서드가 선택될 수 있게 함.
>
> 이와 같은 인터페이스를 정의하는 추상클래스와 인터페이스를 구현하는 구체적인 클래스 간의 상속 관계는 클래스 클래스 기반의 객체지향 언어에서 다형성을 구현하는 가장 기본적인 방법임.

**연결완전성 & 가역성**
- 모델 ↔ 코드가 **유사한 형태**로 이어진다(**연결완전성**).
- 코드 변경에서 **모델 변경을 유추** 가능(**가역성**).
- 도메인 모델은 **문서나 다이어그램이 아니라, 공유된 멘탈 모델**이며, **공통 용어/개념**으로 소통하는 기반.

---

## 정리
- **지도 은유**: **구조**(도메인 모델)를 먼저 세우고, **기능**(유스케이스)은 그 위에 **책임·협력**으로 얹는다.
- **첫 메시지 → 책임 분배 → 협력 형성**: 유스케이스 목표를 **행동(메시지)**로, 도메인 모델을 **구조**로 삼아 통합.
- 이렇게 하면 **변경에 유연**, **재사용성↑**, **표현적 차이↓**, **모델-코드 일관성**을 유지할 수 있다.
